---
title: "Group Lab 1"
output: html_document
author: Group 4

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Part 1: Understanding Our Data
This dataset is derived from the [All China Data Center](https://chinadatacenter.net/Data/Services.aspx) which is formerly affiliated with the University of Michigan. The All China Data Center is run by the All China Marketing Research company, a private research firm. 

While it seems odd that cities like Shanghai and Beijing are included in statistics with provinces, they are special cases in that they are technically [municipalities](https://en.wikipedia.org/wiki/Direct-administered_municipalities_of_China). They have a higher political status than other types of cities, and are considered to be on the same level as provinces. Because they are under direct control of the central government, they are included in this dataset. Other major cities of Tianjin and Chongqing are also classified as municipalities.

Additionally, Hong Kong and [Macau](https://en.wikipedia.org/wiki/Macau) are not included in this dataset becuase although they are "special administrative regions" (SAR) of the PRC, SAR's are "highly autonomous and self-governing sub national subject of the People's Republic of China that is directly under the Central People's Government". In this way, Hong Kong and Macau control their own economies, are only really tied to China in terms of foreign policy and military/defense and therefore produce economic statistics through their own governments. To view Macau's economic data it can be accessed [here](https://www.gov.mo/en/about-macao-sar/statistics/). To view Hong Kong's economic data it can be accessed [here](https://www.hkeconomy.gov.hk/en/situation/index.htm). <!-- Should we include something about Taiwan in this section? -->


<!--Explain the time periods that might be the least reliable, and maybe summarize some of the suggested methods for “correcting” things like GDP data. *Need help with this section- I have not found what time periods are the least reliable nor have I found methods?? See the comments and if you have data, please add-->
Chinese statistics have been notoriously flawed for several reasons ranging from imprecise units of measurement to a lack of attention toward rural areas. In the late 1950s, statistics were seen as a way to show off accomplishment, rather than to communicate accurate and useful data. Throughout the 1950s there was a shortage of employees qualified to handle this data. As a consequence, workers were pressured to submit whatever report they had, regardless of accuracy. This led to a "virtual blackout" in the early 1960s. <!--This article also says that heavy industry statistics tend to be more accurate than those of light industry - wonder how this relates to the data?--> There is a very different cultural attitude toward statistical information than in the US. It is not only due to wanting to present itself well, but a common viewpoint in China is that "a slight discrepancy in figures does no harm".
Generally speaking, economic statistics produced by the central government are consistently inflated in comparison to those produced locally/regionally. The central government has long evaluated local government officials on the basis of The National Bureau of Statistics of China's GDP. Because of this motivation to inflate national statistics, the socialist period (1949-1980) will include <!-- probably inflated data? --> the "reform and opening period" beginning in 1982 will include <!-- more accurate data reflecting changes in the more-free market ? -->
In 2017 China established the Statistical Law Enforcement Supervision Bureau and the government issued “Regulations for Implementation of the Law on Statistics,” which were intended to enable punishment of statistics forgery. 
Statistics produced by private organizations tend to have more accurate data than those produced by the central government.
<!-- general source for this, Phil just said this in the lab 1 prompt -->

Sources: 

* [Economic History of China, 1949 to present](https://en.wikipedia.org/wiki/Economic_history_of_China_(1949%E2%80%93present))
* [How Trustworty are Chinese Statistics?, JapanForward](https://japan-forward.com/how-trustworthy-are-chinese-statistics-china-inflates-gdp-figures-by-478-billion-in-2017/)
* [Macau](https://en.wikipedia.org/wiki/Macau)
* [China Quietly Releases 2017 Provincial GDP Figures, Forbes](https://www.forbes.com/sites/salvatorebabones/2018/02/12/china-quietly-releases-2017-provincial-gdp-figures/#799c69ed20dc)
<!--Really interesting article from the CIA, goes into detail about Chinese history and statistics-->
* [The Problem of Chinese Statistics, CIA](https://www.cia.gov/library/center-for-the-study-of-intelligence/kent-csi/vol16no4/html/v17i1a07p_0001.htm)
<!--Here are a couple more articles on issues with Chinese statistics: https://www.economist.com/finance-and-economics/2018/07/07/chinas-statistics-are-bad-many-criticisms-of-them-are-worse and https://www.bloomberg.com/news/articles/2018-04-19/china-s-economic-stats-have-a-credibility-problem - I can send PDF copies if you run out of free articles to view on the sites-->

## Part 2: Exploring and Visualizing the Data

<!-- Explain interesting changes over time -->

<!-- 5 Visualizations + short explanations -->
```{r, include=FALSE}
library(tidyverse)
```
```{r, echo=FALSE}
object1 <= read.csv(file="China_EO_49to17.csv", fileEncoding = "latin1")
object2 <= as_tibble(object1)
object2$Year <- as.integer(object2$Year)
Year <= seq(from=1949,to=2017)
object2$Year <= Year
#write visualizations here
```
<!--Emmi visualization-->
I chose to plot the enterprise counts of the four non-province municipalities included in the data. A sharp decline in the mid-1950s is attributed to private farms being aggregated into larger organizations. On the plot, it appears as though the count decreased and enterprises had a mass closing, but it was the result of combining these individual entities. Influential economic reforms started in 1979, causing new growth. Patterns post-2000 are indicative of a growing GDP in the late 2000s followed by a decline in growth. Source: [China's Economic Rise by Wayne Morrison](https://fas.org/sgp/crs/row/RL33534.pdf)
```{r, echo = FALSE}
municipalities <- select(object2, Year, Beijing_Enterprise, Tianjin_Enterprise, Shanghai_Enterprise, Chongqing_Enterprise) # Creates new variable with specific columns to examine
MunicipalityComparison <- ggplot(data = municipalities, aes(x = Year)) # New ggplot
Colors <- c("Beijing" = "blueviolet", "Tianjin" = "red", "Shanghai" = "cyan3", "Chongqing" = "blue") # Colors and labels for legend
BJ <- geom_line(aes(y = Beijing_Enterprise, color = "Beijing"), size = 1.5) # Store each line as a variable
TJ <- geom_line(aes(y = Tianjin_Enterprise, color = "Tianjin"), size = 1.5)
SH <- geom_line(aes(y = Shanghai_Enterprise, color = "Shanghai"), size = 1.5)
CQ <- geom_line(aes(y = Chongqing_Enterprise, color = "Chongqing"), size = 1.5)
MunicipalityComparison + BJ + TJ + SH + CQ + scale_color_manual(name="Municipality", values = Colors) + ggtitle("Change in Enterprise Counts in Chinese Municipalities") + theme_bw() + ylab("Enterprise Count")
```

## Part 3: Modifying the Data
<!--Function for output ratios, plot a few interesting comparisons-->
<!-- Plot and summarize relationship between output and number of enterprises for specific provinces -->
<!-- Find other data, visualize it, use it to modify existing data and visualize result -->
<!-- "Hidden" variables, visualize, maybe use statistical tests -->
<!-- Aggregate data by region -->

```{r, echo=FALSE}
# Function to automate producing output ratios
# object1 = the data
# province1 / province2
ratio <- function(object1, province1, province2) {
  object1 = as_tibble(object1) %>% filter(Year >= 2000) %>% arrange(desc(Year))
  object1 = object1[c("Year", province1, province2)] %>% mutate(Output_Ratio = .[[2]]/ .[[3]])
  return (object1)
}
object1 = read.csv("China_EO_49to17.csv")

# Example
# output = ratio(object1, "Guizhou_Output", "Yunnan_Output")


```
After calculating the national output total for each year, we calculated the output percentages for selected provinces in different regions. Xinjiang,a northwestern province, is sparsely populated at around 30 people per square mile. We compared it to the dense (over 300 times that of Xinjiang!) and urban Shanghai. The plot showed Shanghai consistently having a greater share of the output total than Xinjiang, with an extreme spike around 2010. Xinjiang is a predominantly agricultural region, with local governments encouraging its industry. It has its own significant economy, but is dwarfed by the scale of massive Shanghai.
```{r, echo = FALSE}
#Part 3 second part plots. Share of national output total for selected provinces in different areas of the country. Added explanations.
outputs <-read_csv(file="Output_Only.csv")
part3 <- as_tibble(outputs)
selection <- c("Shanghai" = "cyan3", "Xinjiang" = "red", "Beijing" = "darkviolet", "Chongqing" = "darkorange")
east_west <- ggplot(data = part3, aes(x = Year))
shanghai <- geom_line(aes(y = Shanghai_Output_Percentage, color = "Shanghai"), size = 1.5)
xinjiang <- geom_line(aes(y = Xinjiang_Output_Percentage, color = "Xinjiang"), size = 1.5)
east_west <- east_west + shanghai + xinjiang + scale_color_manual(name = "Province/Municipalilty", values = selection) + ggtitle("Eastern vs Western Province") + ylab("Output Percentage") + theme(plot.title = element_text(hjust = 0.5))
east_west
```
The major cities of Beijing and Chongqing were chosen for a north-south comparison. Beijing, located in the north, is a major world city as well as China's capital. Chongqing is a municipality in the southwest. It has a higher population but lower density than Beijing because of its larger area. The plot shows that Chongqing had slower output growth than Beijing until the mid 2010s, where both municipalities showed a steep spike in output percentages. After this dramatic peak, both municipalities' percentages dropped, corresponding to Shanghai's extreme increase at the same time.
```{r, echo = FALSE}
north_south <- ggplot(data = part3, aes(x = Year))
beijing <- geom_line(aes(y = Beijing_Output_Percentage, color = "Beijing"), size = 1.5)
chongqing <- geom_line(aes(y = Chongqing_Output_Percentage, color = "Chongqing"), size = 1.5)
north_south <- north_south + chongqing + beijing + scale_color_manual(name = "Province/Municipalilty", values = selection) + ggtitle("Northern vs Southern Province") + ylab("Output Percentage")+ theme(plot.title = element_text(hjust = 0.5))
north_south
```
```{r, echo = FALSE}
# Part 3, sixth part, aggregated data by region from original csv. Added the new population data by region from another csv. NA values screw up the data in the region_data when I knit the document, but it is calculated correctly when I run the chunk in RStudio. Probably need to change NA values to 0?
pop_csv <- read_csv(file = "AllProvincePop.csv")
pop_byregion <- as_tibble(pop_csv)
region_data <- transmute(object2, year = Year, # Selects only the new calculated columns
n_ent = Beijing_Enterprise + Tianjin_Enterprise + Hebei_Enterprise + Shanxi_Enterprise + InnerMongolia_Enterprise, # North region enterprise
n_output = Beijing_Output + Tianjin_Output + Hebei_Output + Shanxi_Output, # North region output
ne_ent = Liaoning_Enterprise + Jilin_Enterprise + Heilongjiang_Enterprise, # Northeast region enterprise
ne_output = Liaoning_Output + Jilin_Output + Heilongjiang_Output, # Northeast region output
e_ent = Shanghai_Enterprise + Jiangsu_Enterprise + Zhejiang_Enterprise + Anhui_Enterprise + Fujian_Enterprise + Jiangxi_Enterprise + Shandong_Enterprise, # East region enterprise
e_output = Shanghai_Output + Jiangsu_Output + Zhejiang_Output + Anhui_Output + Fujian_Output + Jiangxi_Output + Shandong_Output, # East region output
scentral_ent = Henan_Enterprise + Hubei_Enterprise + Hunan_Enterprises + Guangdong_Enterprise + Guangxi_Enterprise + Hainan_Enterprise, # South central region enterprise
scentral_output = Henan_Output + Hubei_Output + Hunan_Output + Guangdong_Output + Guangxi_Output + Hainan_Output, # South central region output
sw_ent = Chongqing_Enterprise + Sichuan_Enterprise + Guizhou_Enterprise + Yunnan_Enterprise + Tibet_Enterprise, # Southwest regionenterprise
sw_output = Chongqing_Output + Sichuan_Output + Guizhou_Output + Yunnan_Output + Tibet_Output, # Southwest region output
nw_ent = Shaanxi_Enterprise + Gansu_Enterprise + Qinghai_Enterprise + Ningxia_Enterprise + Xinjiang_Enterprise, # Northwest region enterprise
nw_output = Shaanxi_Output + Gansu_Output + Qinghai_Output + Ningxia_Output + Xinjiang_Output) # Northwest region output
pop_data <- transmute(pop_byregion, n_pop = North_Total_Pop, ne_pop = Northeast_Total_Pop, e_pop = East_Total_Pop, scentral_pop = SouthCentral_Total_Pop, sw_pop = Southwest_Total_Pop, nw_pop = Northwest_Total_Pop) # Selects only aggregate columns
region_data <- cbind(region_data, pop_data) # Combines columns
region_data # Displays new selection of data
```
